!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.awaitility=t():e.awaitility=t()}(self,()=>(()=>{"use strict";var e={106:e=>{var t=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,r,o,n){return r=r||"&",o=o||"=",null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map(function(n){var i=encodeURIComponent(t(n))+o;return Array.isArray(e[n])?e[n].map(function(e){return i+encodeURIComponent(t(e))}).join(r):i+encodeURIComponent(t(e[n]))}).filter(Boolean).join(r):n?encodeURIComponent(t(n))+o+encodeURIComponent(t(e)):""}},186:(e,t,r)=>{t.parse=r(630),r(106)},630:e=>{function t(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,r,o,n){r=r||"&",o=o||"=";var i={};if("string"!=typeof e||0===e.length)return i;var s=/\+/g;e=e.split(r);var a=1e3;n&&"number"==typeof n.maxKeys&&(a=n.maxKeys);var c=e.length;a>0&&c>a&&(c=a);for(var u=0;u<c;++u){var f,p,d,y,l=e[u].replace(s,"%20"),m=l.indexOf(o);m>=0?(f=l.substr(0,m),p=l.substr(m+1)):(f=l,p=""),d=decodeURIComponent(f),y=decodeURIComponent(p),t(i,d)?Array.isArray(i[d])?i[d].push(y):i[d]=[i[d],y]:i[d]=y}return i}}},t={};function r(o){var n=t[o];if(void 0!==n)return n.exports;var i=t[o]={exports:{}};return e[o](i,i.exports,r),i.exports}r.d=(e,t)=>{for(var o in t)r.o(t,o)&&!r.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};r.r(o),r.d(o,{Async:()=>i,Notification:()=>n,Path:()=>u,Req:()=>c,Res:()=>a});class n{msg;payload;emitter;source;constructor(e,t={},r=void 0,o=void 0){this.msg=e,this.payload=t,this.emitter=r,this.source=o}}class i{static async within(e,t,r){let o;try{return await Promise.race([t(),new Promise((t,i)=>{o=setTimeout(()=>{const e=new n("timeout-fail",{message:"Operation timed out"},void 0,r);i(e)},e)})])}finally{clearTimeout(o)}}static async resolve(e,t,r,o,n){try{const r="function"==typeof e?e.bind(void 0,t):()=>e;return n?await i.within(n,r,"timeout"):await r()}catch(e){throw r&&(e={...r,source:e}),o&&await o(e),e}}static on(e,t,r,o,n,i){if(i||(i=e),"string"==typeof i&&(i=e[i]||(e[i]={})),n&&i[n]&&this.off(e,t,n,o,i),o?.once&&"function"==typeof e.once)e.once(t,r);else if("function"==typeof e.addEventListener)e.addEventListener(t,r,o);else if("function"==typeof e.addListener)e.addListener(t,r);else{if("function"!=typeof e.on)throw new Error("on-failed",{event:t,fn:r,opts:o,name:n,registry:i},e);e.on(t,r)}n&&(i[n]=r)}static off(e,t,r,o,i){let s=r;if("string"==typeof r){if("string"==typeof i&&(i=e[i]),!i)return;s=i[r],delete i[r]}if(s)if("function"==typeof e.removeEventListener)e.removeEventListener(t,s,o);else if("function"==typeof e.removeListener)e.removeListener(t,s);else{if("function"!=typeof e.off)throw new n("off-failed",{event:t,nameOrFn:r,opts:o,registry:i},e);e.off(t,s)}}static emit(e,t,...r){if("string"!=typeof t&&(r=[t],t=t?.type||"object"),"function"==typeof e.emit)return e.emit(t,...r);if("function"==typeof e.dispatchEvent)return e.dispatchEvent(i.toCustomEvent(r[0]));throw new Error("emit-failed: Target cannot emit events")}static toCustomEvent(e,t="object"){return e instanceof CustomEvent?e:"string"==typeof e?new CustomEvent(e,{detail:{}}):new CustomEvent(e?.type||t,{obj:e})}}var s=r(186);class a{static json(e,t,r,o,n="response"){e.statusCode=t,e.setHeader("Content-Type","application/json"),e.end(JSON.stringify(r)),o?.emit&&o.emit(n,{res:e,code:t,body:r})}static redirect(e,t){e.headersSent||e.writableEnded||(e.statusCode=302,e.setHeader("Location",t),e.end())}static end(e,t,r){return e.statusCode=t,e.end(r)}}class c{static async prepareBody(e,t){if(e.body)return!0;const r=(e.method||"").toUpperCase();if(["POST","PUT","PATCH","DELETE"].includes(r))try{e.body=await c.getBody(e)}catch(r){return e.body={},e._prepareError=r,t&&!t.headersSent&&a.json(t,400,{error:"Invalid JSON in request body"}),!1}return!0}static prepareQuery(e){return e.query||(e.query=c.getQuery(e)),!0}static prepareCookies(e){return e.cookies||(e.cookies=c.getCookies(e)),!0}static async getBody(e){if(e.body)return e.body;if(!["POST","PUT","PATCH"].includes(e.method))return;let t="";if(e.on)for await(const r of e)t+=r;else if("object"==typeof e)return e.body||void 0;if((e.headers?.["content-type"]||"").toLowerCase().includes("application/json"))try{return JSON.parse(t)}catch{throw new Error("Invalid JSON in request body")}return(0,s.parse)(t)}static getCookies(e){if(e.cookies)return e.cookies;const t=e?.headers?.cookie;return t?Object.fromEntries(t.split(";").map(e=>e.split("=").map(e=>e.trim())).filter(([e,t])=>e&&t).map(([e,t])=>[e,decodeURIComponent(t)])):{}}static getQuery(e){if(e.query)return e.query;try{const t=new URL(e?.url||"","http://localhost");return Object.fromEntries(t.searchParams.entries())}catch{return{}}}static getToken(e,t={cookie:"token",header:"Authorization",query:"token"}){const r=c.getCookies(e);if(r&&r[t.cookie])return r[t.cookie];const o=e?.headers?.[t.header?.toLowerCase()];if(o){const e=o.split(" ");return 2===e.length&&/^Bearer$/i.test(e[0])?e[1]:o}const n=c.getQuery(e);return n&&n[t.query]?n[t.query]:void 0}static enforceMethod(e,t,r){const o=Array.isArray(e)?e.map(e=>e.toUpperCase()):e.split(/(?:,|\s)+/).map(e=>e.trim().toUpperCase()).filter(Boolean),n=t.method.toUpperCase();return!!o.includes(n)||(r.setHeader("Allow",o.join(", ")),a.json(r,405,{success:!1,error:"Method Not Allowed"}),!1)}}class u{static normalize(e){if("string"!=typeof e||!e.trim())return"/";try{let t=decodeURIComponent(e).replace(/\/{2,}/g,"/");return t.startsWith("/")||(t="/"+t),t.length>1&&t.endsWith("/")&&(t=t.slice(0,-1)),t||"/"}catch{return"/"}}static isBase(e,t){return"/"===e||e===t||t.startsWith(e+"/")}static*subpaths(e){if("/"===(e=e.trim()))return void(yield e);const t=e.startsWith("/")?"/":"",r=e.split("/");let o;for(let e of r)o=o?o+"/"+e:e,yield t+o}static route(e,t,r,o){const n=t.toUpperCase();if(e&&"function"==typeof e[n.toLowerCase()])e[n.toLowerCase()](r,async(e,t,r)=>{try{await o(e,t)}catch(e){r(e)}});else if(e&&"function"==typeof e.route)e.route({method:n,url:r,handler:o});else if(e&&"function"==typeof e.use&&Array.isArray(e.middleware))e.use(async(e,t)=>{if(e.method.toUpperCase()===n&&e.path===r)try{await o(e.req,e.res),e.respond=!1}catch(t){e.status=500,e.body={error:t.message}}else await t()});else{if(!e||"function"!=typeof e.on)throw new Error("Unsupported application framework");e.on("request",async(e,t)=>{const i=new URL(e.url,`http://${e.headers.host}`).pathname;if(e.method.toUpperCase()===n&&i===r)try{await c.prepare(e,t),await o(e,t)}catch(e){t.statusCode=500,t.end(e.message)}})}}}return o})());